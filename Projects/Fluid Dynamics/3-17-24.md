# Timecard
Worked 2 hours
# Today's plans 
- [x] Understand the time dependent pendulum code
	- [x] How to extract the upper bound on lambda 
- [x] Update fluid system derivation to express the system in terms of density (can reduce the number of variables necessary)
# Plans for next time
- [ ] Derive the $\textbf{M}$ matrix in the paper (write the ODEs in matrix form)
# Other sources to look into
https://en.wikipedia.org/wiki/Linear_matrix_inequality
https://en.wikipedia.org/wiki/Lyapunov_function
https://web.stanford.edu/class/ee363/lectures/lyap.pdf


![[Pasted image 20240317202726.png]]

![[Pasted image 20240317202717.png]]
# Notes

## Yalmip
### usage/syntax
`sdpvar` is a symbolic decision variable that yalmip uses as constraints
- most matlab operators are defined for sdpvar objects

ex: symmetrix matrix
```
P = sdpvar(n,n) % SYMMETRIC!
```

ex: diagonal matrix
```
X = diag(sdpvar(n,1));
```

#### Error codes
https://yalmip.github.io/command/yalmiperror/
### computing decay rate of LTI system with GEVP
https://yalmip.github.io/example/decayrate/
- Problem is quasi-convex (feasible set scales monotonically), solves using bisection
	- Set a lower/upper bound on lambda (programmer decides)
	- Begin bisection. Checks values between lower/upper bound. If it is feasible it updates the lower bound.

==Note don't need to code bisection ourselves, just use `bisection()` solver==
Can compute the lower bound
```
A = [-1 2; -3 -4];
P = sdpvar(2, 2); // symmetric 2x2 matrix

// Lower bound P so it is positive semidefinite (with some offset if desired)
// Constraint A^T P + PA <= -identity
Constraints = [P >= eye(2), A' * P + P*A]

optimize(Constraints, trace(P)) // minimize the trace 

// can solve for the eigenvalue
P0 = value(P);
t_lower = -max(eig(inv(P0)*(A'*P0+P0*A)))/2;
```


Can compute the upper bound
```
t_upper = t_lower*2;
F = [P>=eye(2), A'*P+P*A <= -2*t_upper*P];
ops = sdpsettings('verbose',0,'warning',0);
sol = optimize(F,[],ops);
while ~(sol.problem==1)
    t_upper = t_upper*2;
    F = [P>=eye(2), A'*P+P*A <= -2*t_upper*P];
    sol = optimize(F,[],ops);
end
```

#### Using preexisting bisection solver
```
sdpvar t
Constraints = [P>=eye(2), A'*P+P*A <= -2*t*P];
Objective = -t;
diagnostics = bisection(Constraints, Objective,sdpsettings('solver','mosek'))
```

## Derivation of method
 Lets say we have a differential equation $\frac{d \vec{x}}{dt}= \mathbf{A}\vec{x}$ and you can write the energy of the system $V$ as a quadratic form $V=x^{T}Px$.
 If a system is stable, aka it always decays/attracts to an equilibrium, then
 $$\begin{align}
\frac{dV}{dt} < 0  \\
\dot{x}^{T}Px + x^{T}P\dot{x} < 0 \\
\end{align}$$
We know that $\dot{x}=\textbf{A}x$ so
$$
\begin{align}
(\textbf{A}x)^{T}Px + x^{T}P(\textbf{A}x) < 0 \\
x^{T}(A^{T}P + PA)x < 0
\end{align}
$$
In order for this inequality to hold true,  $A^{T}P + PA$ is negative definite (does not include 0) then $\frac{dV}{dt}<0$

In general the $\frac{d \vec{x}}{dt}= \mathbf{A}\vec{x}$ autonomous system can be characterized by eigenvalues (if all negative and real then decays). However if the matrix is time dependent this is no longer the case.

The Lyapunov method can work for time dependent matrices. So if for all time steps we can find $P$ (assuming it is positive semidefinite) so that the inequality 
$$
A^{T}P + PA \prec 0
$$
Is true, then we know the system is stable.
If it is unstable, then it is bounded by an exponential. Something is bounded by an exponential when
$$
\mid\mid x(t)\mid\mid \leq e^{c\lambda t}\mid\mid x(0)\mid\mid
$$
In the unstable case, when $V >0$ then $\frac{dV}{dt}<2\lambda V$. 
$$
\begin{align}
\frac{dV}{dt}-2\lambda V < 0 \\
x^{T}(A^{T}P + PA)x -x^{T}2\lambda Px <0 \\
x^{T}(A^{T}P + PA - 2\lambda P)x <0 \\ \\
A^{T}P + PA < 2\lambda P
\end{align}
$$

## Interpreting output
![[Pasted image 20240317213403.png]]

![[Pasted image 20240317213448.png]]
- The upper bound on the growth rate is $\lambda_{opt}=0.1019$ in this case
# Questions


